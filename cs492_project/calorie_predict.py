import os, sys
from PIL import Image, ImageFile
ImageFile.LOAD_TRUNCATED_IMAGES = True

def calculate_kalorie(crop_pixel, detection): 
    pixpercal  = [0.017, 0.0018, 0.0007, 0.012,0.0005,0.008,0.01,0.0005,0.035,0,0,0, 0.02,0.0012,0.035,0.01,0.009,0.015,0.02,0,0.01,0,0.008,0,0,0,0.017,0,0.02,0.012,0.008,0,0.01,0,0.035,0.02,0.03,0,0.0005,0.04,0.035,0.0007,0,0.011,0,0,0.008,0.02,0.03,0.011,0.01,0,0,0,0,0,0,0.002,0.0007,0,0.02,0.015,0,0.0036,0,0,0,0.011,0,0.0075,0,0,0,0.005,0.015,0,0,0,0.001,0.013,0.012,0.002,0.02,0.015,0,0.0007,0.04,0.04,0.012,0.01,0.0025]
    
    calories = 0
    for food in detection:
        if food[1] < 0.5:
            if food[0] < 0.25:
                calories += crop_pixel[0] * pixpercal[int(food[4])]
            elif food[0] < 0.45:
                calories += crop_pixel[1] * pixpercal[int(food[4])]
            elif food[0] < 0.63:
                calories += crop_pixel[2] * pixpercal[int(food[4])]
            elif food[0] < 0.83:
                calories += crop_pixel[3] * pixpercal[int(food[4])]
        else:
            if food[0] < 0.4:
                calories += crop_pixel[4] * pixpercal[int(food[4])]
            else:
                calories += crop_pixel[5] * pixpercal[int(food[4])]

    return calories

# crop_pixel = [9012, 12694, 13000, 6000, 17635, 30000 ]
# detection = [[0.5064814686775208, 0.3324074149131775, 0.1648148149251938, 0.2537037134170532, 74], [0.6981481313705444, 0.32083332538604736, 0.14814814925193787, 0.17685185372829437, 1], [0.17546296119689941, 0.29027777910232544, 0.18981482088565826, 0.29722222685813904, 67], [0.8888888955116272, 0.47175925970077515, 0.2222222238779068, 0.23240740597248077, 2], [0.35370370745658875, 0.3375000059604645, 0.14629629254341125, 0.2231481522321701, 78], [0.26759257912635803, 0.6495370268821716, 0.28518518805503845, 0.26759257912635803, 28], [0.6342592835426331, 0.6462963223457336, 0.2907407283782959, 0.28148147463798523, 29]]

# print(calculate_kalorie(crop_pixel, detection))